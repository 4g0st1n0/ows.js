/*! ows.js 2015-02-26 */
var Ows4js={};Ows4js.version="0.0.1",Ows4js.Ows={},Ows4js.Fes={},Ows4js.NOTIE=!0,Ows4js.Proxy="/cgi-bin/proxy.cgi?url=",Ows4js.Util={},window.ActiveXObject&&(Ows4js.NOTIE=!1),Ows4js.Namespaces={csw:"http://www.opengis.net/cat/csw/2.0.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},Ows4js.IESelectionNamespaces=function(){var a=[];for(var b in Ows4js.Namespaces)a.push(b+":'"+Ows4js.Namespaces[b]+"'");return a.join(" ")},Ows4js.nsResolver=function(a){return Ows4js.Namespaces[a]||null},Ows4js.getXPathNode=function(a,b){var c=new XPathEvaluator,d=c.evaluate(b,a,Ows4js.nsResolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return d.singleNodeValue},Ows4js.getXPathNodeList=function(a,b){var c=new XPathEvaluator,d=c.evaluate(b,a,Ows4js.nsResolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);return d},Ows4js.getXPathValue=function(a,b){var c=new XPathEvaluator,d=c.evaluate(b,a,Ows4js.nsResolver,XPathResult.STRING_TYPE,null);return d.stringValue},Ows4js.getXPathValueList=function(a,b){for(var c=[],d=new XPathEvaluator,e=d.evaluate(b,a,Ows4js.nsResolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),f=e.iterateNext();f;)c.push(f.value),f=e.iterateNext();return c},Ows4js.getXPathNodeAttributeValue=function(a,b){return a.getAttributeNode(b).value},Ows4js.Ows.ServiceIdentification=function(a){this.title=Ows4js.getXPathValue(a,"ows:Title"),this["abstract"]=Ows4js.getXPathValue(a,"ows:Abstract"),this.keywords=Ows4js.getXPathValueList(a,"ows:Keywords/ows:Keyword"),this.type=Ows4js.getXPathValue(a,"ows:ServiceType"),this.version=Ows4js.getXPathValue(a,"ows:ServiceTypeVersion"),this.fees=Ows4js.getXPathValue(a,"ows:Fees"),this.accessconstraints=Ows4js.getXPathValue(a,"ows:AccessConstraints")},Ows4js.Ows.ServiceProvider=function(a){this.name=Ows4js.getXPathValue(a,"ows:ProviderName"),this.url=Ows4js.getXPathValue(a,"ows:ProviderSite/@xlink:href");var b=Ows4js.getXPathNode(a,"ows:ServiceContact");this.contact={},this.contact.name=Ows4js.getXPathValue(b,"ows:IndividualName"),this.contact.position=Ows4js.getXPathValue(b,"ows:PositionName"),this.contact.role=Ows4js.getXPathValue(b,"/ows:Role");var c=Ows4js.getXPathNode(b,"ows:ContactInfo");this.contact.phone=Ows4js.getXPathValue(c,"ows:Phone/ows:Voice"),this.contact.fax=Ows4js.getXPathValue(c,"ows:Phone/ows:Facsimile"),this.contact.address={};var d=Ows4js.getXPathNode(c,"ows:Address");this.contact.address.delivery=Ows4js.getXPathValue(d,"ows:DeliveryPoint"),this.contact.address.city=Ows4js.getXPathValue(d,"ows:City"),this.contact.address.adminarea=Ows4js.getXPathValue(d,"ows:AdministrativeArea"),this.contact.address.postalcode=Ows4js.getXPathValue(d,"ows:PostalCode"),this.contact.address.country=Ows4js.getXPathValue(d,"ows:Country"),this.contact.address.email=Ows4js.getXPathValue(d,"ows:ElectronicMailAddress"),this.contact.url=Ows4js.getXPathValue(c,"ows:OnlineResource/@xlink:href"),this.contact.hours=Ows4js.getXPathValue(c,"ows:HoursOfService"),this.contact.instructions=Ows4js.getXPathValue(c,"ows:ContactInstructions")},Ows4js.Ows.OperationsMetadata=function(a){var b=null,c=null,d=null,e=null,f=null,g=null;for(this.operations=[],this.parameters=[],this.constraints=[],b=Ows4js.getXPathNodeList(a,"ows:Operation"),d=b.iterateNext();d;){for(f={},f.name=Ows4js.getXPathValue(d,"@name"),f.dcp={http:{}},f.dcp.http.get=Ows4js.getXPathValue(d,"ows:DCP/ows:HTTP/ows:Get/@xlink:href"),f.dcp.http.post=Ows4js.getXPathValue(d,"ows:DCP/ows:HTTP/ows:Post/@xlink:href"),f.parameters=[],c=Ows4js.getXPathNodeList(d,"ows:Parameter"),e=c.iterateNext();e;)g={},g.name=Ows4js.getXPathValue(e,"@name"),g.values=Ows4js.getXPathValueList(e,"ows:Value"),f.parameters.push(g),e=c.iterateNext();for(f.constraints=[],c=Ows4js.getXPathNodeList(d,"ows:Constraint"),e=c.iterateNext();e;)g={},g.name=Ows4js.getXPathValue(e,"@name"),g.values=Ows4js.getXPathValueList(e,"ows:Value"),f.parameters.push(g),e=c.iterateNext();this.operations.push(f),d=b.iterateNext()}for(b=Ows4js.getXPathNodeList(a,"ows:Parameter"),d=b.iterateNext();d;)g={},g.name=Ows4js.getXPathValue(d,"@name"),g.values=Ows4js.getXPathValueList(d,"ows:Value"),this.parameters.push(g),d=b.iterateNext();for(b=Ows4js.getXPathNodeList(a,"ows:Constraint"),d=b.iterateNext();d;)g={},g.name=Ows4js.getXPathValue(d,"@name"),g.values=Ows4js.getXPathValueList(d,"ows:Value"),this.constraints.push(g),d=b.iterateNext()},Ows4js.Fes.FilterCapabilities=function(a){this.spatials={},this.scalars={},this.ids={},this.spatials.geometries=Ows4js.getXPathValueList(a,"ogc:Spatial_Capabilities/ogc:GeometryOperands/ogc:GeometryOperand"),this.spatials.operators=Ows4js.getXPathValueList(a,"//ogc:SpatialOperators/ogc:SpatialOperator/@name"),this.scalars.comparisons=Ows4js.getXPathValueList(a,"//ogc:ComparisonOperators/ogc:ComparisonOperator"),this.scalars.functions=Ows4js.getXPathValueList(a,"//ogc:FunctionNames/ogc:FunctionName")},Ows4js.loadXMLDoc=function(a){var b;try{if(console.debug("no proxy"),b=this.Util.httpGet(a),console.debug("found no proxy"),200!==b.status)throw"HTTP status code "+b.status;return b.responseXML}catch(c){try{if(console.warn(c),console.debug("with proxy"),b=this.Util.httpGet(Ows4js.Proxy+a),console.debug("found with proxy"),200!==b.status)throw"HTTP status code "+b.status;return b.responseXML}catch(d){throw console.error(d),"Unable to load XML from URL"}}},Ows4js.loadXMLString=function(a){var b=null,c=null;return Ows4js.NOTIE?(b=new DOMParser,c=b.parseFromString(a,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a)),c},Ows4js.Util.httpGet=function(a){var b;try{try{b=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){b=new XMLHttpRequest}return b.open("GET",a,!1),b.send(null),b}catch(c){throw c}},Ows4js.Util.httpPost=function(a,b,c){var d;try{try{d=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){d=new XMLHttpRequest}return d.open("POST",a,!1),d.setRequestHeader("Accept-Language",b),d.send(c),d}catch(e){throw e}},Ows4js.Util.buildUrl=function(a,b){var c=[];for(var d in b)null!==b[d]&&c.push(d+"="+b[d]);return a+"?"+c.join("&")},Ows4js.Filter=function(){this.name={key:"{http://www.opengis.net/ogc}Filter",localPart:"Filter",namespaceURI:"http://www.opengis.net/ogc",prefix:"ogc",string:"{http://www.opengis.net/ogc}ogc:Filter"},this.value={TYPE_NAME:"Filter_1_1_0.FilterType"}},Ows4js.Filter.prototype.PropertyName=function(a){return this.value.comparisonOps={name:{key:"{http://www.opengis.net/ogc}PropertyIsLike",localPart:"PropertyIsLike",namespaceURI:"http://www.opengis.net/ogc",prefix:"ogc",string:"{http://www.opengis.net/ogc}ogc:PropertyIsLike"},value:{TYPE_NAME:"Filter_1_1_0.PropertyIsLikeType",literal:{TYPE_NAME:"Filter_1_1_0.LiteralType",content:null},propertyName:{TYPE_NAME:"Filter_1_1_0.PropertyNameType",content:a}}},this},Ows4js.Filter.prototype.isLike=function(a){return this.value.comparisonOps.value.literal.content=[a],this.value.comparisonOps.value.escapeChar="",this.value.comparisonOps.value.singleChar="_",this.value.comparisonOps.value.wildCard="%",this},Ows4js.Filter.prototype.isNull=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isNill=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isBetween=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isEqualTo=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isLessThanEqualTo=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isGreaterThan=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isLessThan=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isGreaterThanEqualTo=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isNotEqualTo=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.isNullCheck=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.and=function(a){if("undefined"==typeof this.value.logicOps)if(console.debug("The first And"),this.value.logicOps={name:{key:"{http://www.opengis.net/ogc}And",localPart:"And",namespaceURI:"http://www.opengis.net/ogc",prefix:"ogc",string:"{http://www.opengis.net/ogc}ogc:And"},value:{TYPE_NAME:"Filter_1_1_0.BinaryLogicOpType"}},"undefined"!=typeof this.value.comparisonOps)this.value.logicOps.value.comparisonOpsOrSpatialOpsOrLogicOps=[this.value.comparisonOps].concat(Ows4js.Filter.getPreviousOperator(a)),delete this.value.comparisonOps;else{if("undefined"==typeof this.value.spatialOps)throw"Not Implemented yet, another operators";this.value.logicOps.value.comparisonOpsOrSpatialOpsOrLogicOps=[this.value.spatialOps].concat(Ows4js.Filter.getPreviousOperator(a)),delete this.value.spatialOps}else this.value.logicOps.value.comparisonOpsOrSpatialOpsOrLogicOps=this.value.logicOps.value.comparisonOpsOrSpatialOpsOrLogicOps.concat(Ows4js.Filter.getPreviousOperator(a));return this},Ows4js.Filter.getPreviousOperator=function(a){var b;if("undefined"!=typeof a.value.comparisonOps)b=a.value.comparisonOps;else{if("undefined"==typeof a.value.spatialOps)throw"Not Implemented yet, another operators";b=a.value.spatialOps}return b},Ows4js.Filter.prototype.or=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.not=function(){throw"Not Implemented yet"},Ows4js.Filter.prototype.BBOX=function(a,b,c,d,e){return this.value.spatialOps={name:{key:"{http://www.opengis.net/ogc}BBOX",localPart:"BBOX",namespaceURI:"http://www.opengis.net/ogc",prefix:"ogc",string:"{http://www.opengis.net/ogc}ogc:BBOX"},value:{TYPE_NAME:"Filter_1_1_0.BBOXType",envelope:{name:{key:"{http://www.opengis.net/gml}Envelope",localPart:"Envelope",namespaceURI:"http://www.opengis.net/gml",prefix:"gml",string:"{http://www.opengis.net/gml}gml:Envelope"},value:{TYPE_NAME:"GML_3_1_1.EnvelopeType",srsName:e,lowerCorner:{TYPE_NAME:"GML_3_1_1.DirectPositionType",value:[a,b]},upperCorner:{TYPE_NAME:"GML_3_1_1.DirectPositionType",value:[c,d]}}},propertyName:{TYPE_NAME:"Filter_1_1_0.PropertyNameType",content:"ows:BoundingBox"}}},this},Ows4js.Filter.JsonixContext=new Jsonix.Context([OWS_1_0_0,DC_1_1,DCT,XLink_1_0,SMIL_2_0,SMIL_2_0_Language,GML_3_1_1,Filter_1_1_0,CSW_2_0_2]),Ows4js.Filter.prototype.getXML=function(){var a,b=Ows4js.Filter.JsonixContext.createMarshaller();return a=b.marshalDocument(this)},Ows4js.Csw={},Ows4js.Csw=function(a){var b=null;this.url=a,this.version="2.0.2";var c={service:"CSW",version:this.version,request:"GetCapabilities"};console.log(this.url);try{try{console.debug("Fetching url with params"),this.xml=Ows4js.loadXMLDoc(Ows4js.Util.buildUrl(this.url,c))}catch(d){console.debug("Fetching url with no params (static doc)"),this.xml=Ows4js.loadXMLDoc(this.url,c)}}catch(e){console.error(e),this.xml=Ows4js.loadXMLString(this.url,c)}console.debug("Procesing ows:ServiceIdentificaiton"),b=Ows4js.getXPathNode(this.xml,"//ows:ServiceIdentification"),this.identification=new Ows4js.Ows.ServiceIdentification(b),console.debug("Procesing ows:ServiceProvider"),b=Ows4js.getXPathNode(this.xml,"//ows:ServiceProvider"),this.provider=new Ows4js.Ows.ServiceProvider(b),console.debug("Procesing ows:OpeartionsMetadata"),b=Ows4js.getXPathNode(this.xml,"//ows:OperationsMetadata"),this.operationsmetadata=new Ows4js.Ows.OperationsMetadata(b),console.debug("Procesing ogc:Filter_Capabilities"),b=Ows4js.getXPathNode(this.xml,"//ogc:Filter_Capabilities"),this.filtercapabilities=new Ows4js.Fes.FilterCapabilities(b)},Ows4js.Csw.prototype.GetRecords=function(a,b,c){var d=new Ows4js.Csw.Query("full",new Ows4js.Csw.Constraint(c)),e=new Ows4js.Csw.GetRecords(a,b,d);console.log(e),console.log(JSON.stringify(e));var f=Ows4js.Csw.marshalDocument(e);console.log(f);var g=Ows4js.Util.httpPost(this.url,"application/xml",f);return Ows4js.Csw.unmarshalDocument(g.responseXML)},Ows4js.Csw.jsonnixContext=new Jsonix.Context([OWS_1_0_0,DC_1_1,DCT,XLink_1_0,SMIL_2_0,SMIL_2_0_Language,GML_3_1_1,Filter_1_1_0,CSW_2_0_2]),Ows4js.Csw.marshalDocument=function(a){return Ows4js.Csw.jsonnixContext.createMarshaller().marshalDocument(a)},Ows4js.Csw.unmarshalDocument=function(a){return Ows4js.Csw.jsonnixContext.createUnmarshaller().unmarshalDocument(a)},Ows4js.Csw.unmarshalString=function(a){return Ows4js.Csw.jsonnixContext.createUnmarshaller().unmarshalString(a)},Ows4js.Csw.prototype.GetRecordById=function(a){var b=new Ows4js.Csw.GetRecordById(a);console.log(b);var c=Ows4js.Csw.marshalDocument(b);console.log(c);var d=Ows4js.Util.httpPost(this.url,"application/xml",c);return console.log(d.responseXML),Ows4js.Csw.unmarshalDocument(d.responseXML)},Ows4js.Csw.prototype.getOperationByName=function(a){for(var b=0;b<this.operationsmetadata.operations.length;b++){var c=this.operationsmetadata.operations[b].name.toLowerCase();if(a.toLowerCase()===c)return this.operationsmetadata.operations[b]}return!1},Ows4js.Csw.Constraint=function(a){this.TYPE_NAME="CSW_2_0_2.QueryConstraintType",this.version="1.1.0",this.filter=a},Ows4js.Csw.GetRecords=function(a,b,c){this.name={key:"{http://www.opengis.net/cat/csw/2.0.2}GetRecords",localPart:"GetRecords",namespaceURI:"http://www.opengis.net/cat/csw/2.0.2",prefix:"csw",string:"{http://www.opengis.net/cat/csw/2.0.2}csw:GetRecords"},this.value={TYPE_NAME:"CSW_2_0_2.GetRecordsType",startPosition:a,maxRecords:b,resultType:"results",service:"CSW",version:"2.0.2",abstractQuery:c}},Ows4js.Csw.GetRecordById=function(a){this.name={key:"{http://www.opengis.net/cat/csw/2.0.2}GetRecordById",localPart:"GetRecordById",namespaceURI:"http://www.opengis.net/cat/csw/2.0.2",prefix:"csw",string:"{http://www.opengis.net/cat/csw/2.0.2}csw:GetRecordById"},this.value={TYPE_NAME:"CSW_2_0_2.GetRecordByIdType",elementSetName:{ObjectTYPE_NAME:"CSW_2_0_2.ElementSetNameType",value:"full"},id:a,service:"CSW",version:"2.0.2"}},Ows4js.Csw.Query=function(a,b){this.name={key:"{http://www.opengis.net/cat/csw/2.0.2}Query",localPart:"Query",namespaceURI:"http://www.opengis.net/cat/csw/2.0.2",prefix:"csw",string:"{http://www.opengis.net/cat/csw/2.0.2}csw:Query"},this.value={TYPE_NAME:"CSW_2_0_2.QueryType",elementSetName:{TYPE_NAME:"CSW_2_0_2.ElementSetNameType",value:a},typeNames:[{key:"{http://www.opengis.net/cat/csw/2.0.2}Record",localPart:"Record",namespaceURI:"http://www.opengis.net/cat/csw/2.0.2",prefix:"csw",string:"{http://www.opengis.net/cat/csw/2.0.2}csw:Record"}]},b&&(this.value.constraint=b)};